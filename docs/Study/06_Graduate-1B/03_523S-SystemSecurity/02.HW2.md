---
sidebar_position: 2
id: HW2
title: HW2
tags:
  - Study
  - Graduate
  - System Security
---


## 1. What does this program do? (1 point)

1. Confirm the file type:  
```shell
file hw2
```

And here is my output, for reference:  
```shell
[02/28/25]seed@VM:Yuanjun$file hw2
hw2: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=9bb7da34107bbc5a04e8e0ec14bb5ec7f46bd39f, not stripped
```  
This indicates that the file is an ELF 32-bit executable file and not stripped, which means that we can use `objdump` or `gdb` to analyze the file.

2. Disassemble the file:  

    1. List symbols:  
    ```shell
    nm -c hw2
    ```

    And the output:  
    ```shell
    [02/28/25]seed@VM:Yuanjun$nm -C hw2
    0804a030 B __bss_start
    0804a030 b completed.7200
    0804a028 D __data_start
    0804a028 W data_start
    08048440 t deregister_tm_clones
    080484b0 t __do_global_dtors_aux
    08049f0c d __do_global_dtors_aux_fini_array_entry
    0804a02c D __dso_handle
    08049f14 d _DYNAMIC
    0804a030 D _edata
    0804a034 B _end
            U exit@@GLIBC_2.0
    08048654 T _fini
    08048668 R _fp_hw
    080484d0 t frame_dummy
    08049f08 d __frame_dummy_init_array_entry
    08048824 r __FRAME_END__
    08048524 T getPassword
    0804a000 d _GLOBAL_OFFSET_TABLE_
            w __gmon_start__
    080486e0 r __GNU_EH_FRAME_HDR
    0804834c T _init
    08049f0c d __init_array_end
    08049f08 d __init_array_start
    0804866c R _IO_stdin_used
            w _ITM_deregisterTMCloneTable
            w _ITM_registerTMCloneTable
    08049f10 d __JCR_END__
    08049f10 d __JCR_LIST__
            w _Jv_RegisterClasses
    08048650 T __libc_csu_fini
    080485f0 T __libc_csu_init
            U __libc_start_main@@GLIBC_2.0
    08048562 T main
            U printf@@GLIBC_2.0
            U puts@@GLIBC_2.0
    08048470 t register_tm_clones
    080484fb T secret_func
    08048400 T _start
            U strcmp@@GLIBC_2.0
            U strcpy@@GLIBC_2.0
            U system@@GLIBC_2.0
    0804a030 D __TMC_END__
    08048430 T __x86.get_pc_thunk.bx
    ```

    2. Disassemble the `main` function:  
    ```shell
    gdb -q hw2
    <gdb> disassemble main
    ```

    And the output:  
    ```shell
    gdb-peda$ disassemble main
    Dump of assembler code for function main:
        0x08048562 <+0>:	lea    ecx,[esp+0x4]
        0x08048566 <+4>:	and    esp,0xfffffff0
        0x08048569 <+7>:	push   DWORD PTR [ecx-0x4]
        0x0804856c <+10>:	push   ebp
        0x0804856d <+11>:	mov    ebp,esp
        0x0804856f <+13>:	push   ecx
        0x08048570 <+14>:	sub    esp,0x14
        0x08048573 <+17>:	mov    eax,ecx
        0x08048575 <+19>:	mov    BYTE PTR [ebp-0x9],0x61
        0x08048579 <+23>:	cmp    DWORD PTR [eax],0x1
        0x0804857c <+26>:	jg     0x804859e <main+60>
        0x0804857e <+28>:	mov    eax,DWORD PTR [eax+0x4]
        0x08048581 <+31>:	mov    eax,DWORD PTR [eax]
        0x08048583 <+33>:	sub    esp,0x8
        0x08048586 <+36>:	push   eax
        0x08048587 <+37>:	push   0x80486a6
        0x0804858c <+42>:	call   0x8048390 <printf@plt>
        0x08048591 <+47>:	add    esp,0x10
        0x08048594 <+50>:	sub    esp,0xc
        0x08048597 <+53>:	push   0x0
        0x08048599 <+55>:	call   0x80483d0 <exit@plt>
        0x0804859e <+60>:	mov    eax,DWORD PTR [eax+0x4]
        0x080485a1 <+63>:	add    eax,0x4
        0x080485a4 <+66>:	mov    eax,DWORD PTR [eax]
        0x080485a6 <+68>:	sub    esp,0xc
        0x080485a9 <+71>:	push   eax
        0x080485aa <+72>:	call   0x8048524 <getPassword>
        0x080485af <+77>:	add    esp,0x10
        0x080485b2 <+80>:	test   eax,eax
        0x080485b4 <+82>:	je     0x80485c8 <main+102>
        0x080485b6 <+84>:	sub    esp,0xc
        0x080485b9 <+87>:	push   0x80486bc
        0x080485be <+92>:	call   0x80483b0 <puts@plt>
        0x080485c3 <+97>:	add    esp,0x10
        0x080485c6 <+100>:	jmp    0x80485d8 <main+118>
        0x080485c8 <+102>:	sub    esp,0xc
        0x080485cb <+105>:	push   0x80486ce
        0x080485d0 <+110>:	call   0x80483b0 <puts@plt>
        0x080485d5 <+115>:	add    esp,0x10
        0x080485d8 <+118>:	mov    eax,0x0
        0x080485dd <+123>:	mov    ecx,DWORD PTR [ebp-0x4]
        0x080485e0 <+126>:	leave  
        0x080485e1 <+127>:	lea    esp,[ecx-0x4]
        0x080485e4 <+130>:	ret    
    End of assembler dump.
    ```

    3. Disassemble the `getPassword` function:  
    ```shell
    <gdb> disassemble getPassword
    ```

    And the output:  
    ```shell
    gdb-peda$ disassemble getPassword
    Dump of assembler code for function getPassword:
        0x08048524 <+0>:	push   ebp
        0x08048525 <+1>:	mov    ebp,esp
        0x08048527 <+3>:	sub    esp,0x38
        0x0804852a <+6>:	sub    esp,0x8
        0x0804852d <+9>:	push   DWORD PTR [ebp+0x8]
        0x08048530 <+12>:	lea    eax,[ebp-0x2a]
        0x08048533 <+15>:	push   eax
        0x08048534 <+16>:	call   0x80483a0 <strcpy@plt>
        0x08048539 <+21>:	add    esp,0x10
        0x0804853c <+24>:	sub    esp,0x8
        0x0804853f <+27>:	push   0x804869e
        0x08048544 <+32>:	lea    eax,[ebp-0x2a]
        0x08048547 <+35>:	push   eax
        0x08048548 <+36>:	call   0x8048380 <strcmp@plt>
        0x0804854d <+41>:	add    esp,0x10
        0x08048550 <+44>:	test   eax,eax
        0x08048552 <+46>:	jne    0x804855b <getPassword+55>
        0x08048554 <+48>:	mov    eax,0x1
        0x08048559 <+53>:	jmp    0x8048560 <getPassword+60>
        0x0804855b <+55>:	mov    eax,0x0
        0x08048560 <+60>:	leave  
        0x08048561 <+61>:	ret    
    End of assembler dump.
    ```

### Answer
So we can now answer the first question - what does this program do?

The `main` function first checks the number of arguments passed to the program and then passes the first argument to the `getPassword` function.

Then `getPassword` compares the input string with a predefined string, which is stored at address **0x804869e**. If the input string is the same as the predefined string, the function returns **1**; otherwise, it returns **0**.

Finally, the `main` function prints different messages based on the return value of the `getPassword` function.

